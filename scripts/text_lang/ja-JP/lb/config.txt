<h1>設定</h1>

<a name="con"></a><p class="label1"><b>コンセプト</b></p>
<p>
ここでは、設定の詳細に入る前に知っておくべき基本的な概念をいくつか紹介します。
</p>


<ul><a name="cl"></a>
<li><span class="label1">クラスタ</span></li>
<p>
クラスタとは、同じ種類のサービスを提供するバックエンドサーバーのグループです。
各サーバーは、クラスタノード、または単にノードと呼ばれます。
ロードバランサは、いくつかのルールに基づいてクラスタノードに要求を配信します。
通常、均等に分配することが好ましい。
LiteSpeed Load Balancerを使用して、必要な数のクラスタにサービスを提供できます。 

<br>
</p>

<a name="vh"></a>
<li><span class="label1">バーチャルホスト</span></li>
<p>
LiteSpeed Load Balancerを使用して、異なるクラスター上にある複数のWebサイト（バーチャルホスト）のロードバランシングを行うことができます。

<br>
</p>
<a name="l"></a>
  <li><span class="label1">リスナー</span></li>

<p>LiteSpeed Load Balancerのリスナーは、特定のIPアドレスとTCPポートをリッスンするサーバーソケットです。 
</p>
<p>各リスナーに対して、IPアドレスとポート番号を指定する必要があります。
IPアドレスには、有効なローカルIPアドレス、またはそのマシン上で使用可能なすべてのIPアドレスを参照するワイルドカードIPを使用できます。
ポートは0〜65535の整数です。
HTTPの公式ポートは80、HTTPSは443です。
ただし、他のポートも使用できます。
UNIXマシンでは、スーパーユーザー "root"のみが1024未満のポートを使用する権限を持っています。</p>
<p>
IPとポートの組み合わせごとに1つのリスナーのみが許可されます。
したがって、リスナーがワイルドカードIPアドレスを持つ1つのポートで設定されている場合、特定の1つのIPであっても、同じポート上に別のリスナーを設定することはできません。
たとえば、ロードバランサマシンに複数のIPアドレスがある場合、HTTPトラフィックはすべてのIPアドレスに対してポート8080で許可する必要があります。これは2通りの方法で設定できます。
ワイルドカードIP（*）とポート8080を使用して1つのリスナのみを設定する。 
特定のIPとポート8080を使用して複数のリスナを設定することができます。
これら2つの方法を同じポート上で混在させることはできません。
</p>  
<p> 
LiteSpeedロードバランサには、プレーンとセキュア（SSL）の2種類のリスナーがあります。
各セキュアリスナーには、SSL秘密鍵とSSL証明書のペアが必要です。
秘密鍵はOpenSSLのようなSSLツールキットで生成することができます。
SSL証明書は、自己署名することも、VeriSignやThawteのようなSSL証明書の発行者から取得することもできます。
同じ秘密鍵と証明書のペアを複数のリスナー間で共有することができます。</p>
<br>
<a name="map"></a><li><span class="label1">リスナーからバーチャルホストへのマッピング</span></li>
<p>
すべてのリスナーにはバーチャルホストルックアップテーブルがあります。 ルックアップテーブルのデータは、キーと値のペアです。
キーはそのバーチャルホストのドメイン名です ； 値はバーチャルホスト自体です。</p>
<p>これはどのように動作するのですか：<br>
<ol><li>エンドユーザーがブラウザにURLを入力する</li>
	<li>ブラウザはDNSルックアップ要求を送信して、ドメイン名からロードバランサのIPアドレスを取得します</li>
	<li>ブラウザは、特定のIPおよびポート（リスナー）上のロードバランサとのTCP接続を確立する要求を送信し、</li>
	<li>接続が確立された後、ブラウザはウェブサイトのドメイン名情報を含むHTTPリクエストを送信する。</li>
	<li>ロードバランサが要求を受信すると、そのリスナーに関連付けられたルックアップテーブルが要求内のドメイン名に対して検索され、一致が見つかった場合、要求は処理のためにバーチャルホストにルーティングされます。</li>
	<li> ロードバランサはクラスタノード上のバーチャルホストからの応答を受け取り、クライアントブラウザに返信します。</li>
</ol>

<p> 名前ベースのバーチャルホスティングの仕組みです； IPベースのバーチャルホスティングは特別なケースです。</p>

<p>バーチャルホストを特定のリスナーからアクセスできるようにするには、次のことを確認する必要があります：</p>
<ol><li>Webサイトのドメイン名をそのリスナーが使用するIPにマップするには、DNSを適切に構成する必要があります。
        DNSの設定方法はこのドキュメントの範囲を超えています。</li>    
    <li>そのドメイン名のバーチャルホストへのマッピングは、リスナーのルックアップテーブルに存在する必要があります。</li>
</ol>
  <p>キャッチオールバーチャルホストは、ワイルドカードドメイン名"*"を持つ1つのリスナーに対して指定できます。
     サーバが一致するバーチャルホストを見つけられない場合、要求はキャッチオールバーチャルホストにルーティングされます。
     そのようなキャッチオールバーチャルホストが設定されていない場合、ロードバランサはエラーコード404を返します。
  </p>

<p>リスナーからバーチャルホストマッピングの設計は、非常に柔軟性があり、</p>
<ul>
<li>1つのリスナーを1つのバーチャルホストにマッピングします。</li>
<li>1つのリスナを異なるドメイン名の異なるバーチャルホストにマッピングします。</li>
<li>複数のリスナーを同じバーチャルホストにマッピングします。</li>
<li>複数のリスナーをそれぞれのドメイン名で複数のバーチャルホストにマッピングします。</li>
</ul>


<p>SSL証明書はリスナーにバンドルされているため、バーチャルホストに専用の証明書が必要な場合は、そのバーチャルホスト用の専用SSLリスナーを作成する必要があります。
つまり、そのバーチャルホストはIPベースのバーチャルホストでなければなりません。
</p>
</ul>
